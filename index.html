<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gaza Listening Drill with Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      line-height: 1.6;
      background: #f4f4f4;
    }
    .block {
      background: white;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    .status {
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .collapsible {
      background-color: #eee;
      cursor: pointer;
      padding: 0.5rem;
      border: none;
      text-align: left;
      font-size: 1rem;
      width: 100%;
      margin-top: 0.5rem;
    }
    .active, .collapsible:hover {
      background-color: #ccc;
    }
    .content {
      padding: 0.5rem 1rem;
      display: none;
      overflow: hidden;
      background-color: #f9f9f9;
      border-left: 3px solid #999;
      margin-top: 0.5rem;
    }
    .quiz {
      margin-top: 1rem;
    }
    .quiz button {
      display: block;
      width: 100%;
      margin: 0.3rem 0;
      padding: 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #fafafa;
      cursor: pointer;
    }
    .quiz button.correct {
      background-color: #c8f7c5;
    }
    .quiz button.wrong {
      background-color: #f7c5c5;
    }
  </style>
</head>
<body>

<script>
const blocks = [
  {
    sentence: "The UK-based Al Khair Foundation said a team of charity workers has been killed in Israeli airstrikes in northern Gaza.",
    file: "1.mp3"
  },
  {
    sentence: "The charity says at least 8 workers, including volunteers and journalists documenting their work, were killed when their vehicles were targeted Saturday.",
    file: "2.mp3"
  },
  {
    sentence: "Hamas called it a blatant violation of the ceasefire agreement with Israel.",
    file: "3.mp3"
  },
  {
    sentence: "The Israeli military said it struck two terrorists operating a drone that posed a threat to Israeli troops and later targeted additional terrorists at the scene.",
    file: "4.mp3"
  },
  {
    sentence: "The charity denies the allegation, saying its team members were not terrorists.",
    file: "5.mp3"
  },
  {
    sentence: "The attack comes as US-designated terror group Hamas leaders hold ceasefire talks with mediators in Cairo.",
    file: "6.mp3"
  },
  {
    sentence: "Hamas says it will only release an American-Israeli hostage and the bodies of four others if Israel fully implements the ceasefire agreement in Gaza.",
    file: "7.mp3"
  },
  {
    sentence: "A senior Hamas official says talks on the truce's next phase must start immediately and last no more than 50 days.",
    file: "8.mp3"
  }
];

function renderBlocks() {
  blocks.forEach((item, index) => {
    const block = document.createElement("div");
    block.className = "block";

    block.innerHTML = `
      <h2>Sentence ${index + 1}/8</h2>
      <audio id="audio${index}" controls>
        <source src="${item.file}" type="audio/mpeg">
      </audio>
      <div class="status" id="status${index}">â¬œ Not played</div>
      <button class="collapsible">ðŸ“œ Show Sentence</button>
      <div class="content" id="script${index}">${item.sentence}</div>
      <div class="quiz" id="quiz${index}">
        <strong>Where is this news taking place?</strong>
        <button onclick="checkAnswer(this, true)">Gaza</button>
        <button onclick="checkAnswer(this, false)">Beirut</button>
        <button onclick="checkAnswer(this, false)">Tehran</button>
      </div>
    `;
    document.body.appendChild(block);

    const audio = block.querySelector("audio");
    const status = block.querySelector(".status");
    const storageKey = `played_quiz_${index}`;
    const stored = localStorage.getItem(storageKey);
    if (stored) {
      const data = JSON.parse(stored);
      status.textContent = `âœ… Played (${data.timestamp})`;
    }

    audio.addEventListener("ended", () => {
      const now = new Date();
      const t = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
      status.textContent = `âœ… Played (${t})`;
      localStorage.setItem(storageKey, JSON.stringify({ timestamp: t }));
    });

    const coll = block.querySelector(".collapsible");
    const content = block.querySelector(".content");
    coll.addEventListener("click", () => {
      coll.classList.toggle("active");
      content.style.display = content.style.display === "block" ? "none" : "block";
    });
  });
}

function checkAnswer(btn, isCorrect) {
  if (isCorrect) {
    btn.classList.add("correct");
    btn.textContent += " âœ… Correct!";
  } else {
    btn.classList.add("wrong");
    btn.textContent += " âŒ Try again";
  }
  const buttons = btn.parentElement.querySelectorAll("button");
  buttons.forEach(b => b.disabled = true);
}

window.onload = renderBlocks;
</script>

</body>
</html>
