<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>News Audio Sentence Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* …（省略）… */
  </style>
</head>
<body>

  <h1>News Audio Sentence Tracker</h1>

  <script>
    // あらかじめ URL エンコードしたフォルダ名
    const baseFile = "September%2023%202024%20%E2%80%93%201000%20UTC%20Heaviest%20Cross-Border%20Strikes%20in%20a%20Year";

    const sentences = [
      "Smoke was seen rising on Sunday in southern Lebanon near the border with Israel as audio of missiles exploding were heard.",
      // …（省略）…
      "The conflict, which sharply escalated over the past week, has raged since Hezbollah opened a second front against Israel after Israel went to war with Hamas in the Palestinian enclave of Gaza triggered by the Hamas-led rampage into southern Israel on October 7th, 2023."
    ];

    function getFormattedDateTime() {
      const now = new Date();
      return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
    }

    function setupBlock(audioId, statusId, storageKey) {
      const audio = document.getElementById(audioId);
      const status = document.getElementById(statusId);
      const stored = localStorage.getItem(storageKey);
      if (stored) {
        const data = JSON.parse(stored);
        status.textContent = `✅ Played (${data.timestamp})`;
      }
      audio.addEventListener("ended", () => {
        const timestamp = getFormattedDateTime();
        localStorage.setItem(storageKey, JSON.stringify({ played: true, timestamp }));
        status.textContent = `✅ Played (${timestamp})`;
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      const container = document.body;

      // 各センテンスブロック
      sentences.forEach((text, i) => {
        const num = i + 1;
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h2>Sentence ${num}/${sentences.length}</h2>
          <audio id="audio${num}" controls>
            <source src="./${baseFile}/${num}.mp3" type="audio/mpeg">
          </audio>
          <div class="status" id="status${num}">⬜ Not played</div>
          <button class="collapsible">📜 Show Script</button>
          <div class="content">${text}</div>
        `;
        container.appendChild(card);
        setupBlock(`audio${num}`, `status${num}`, `audioPlayed_${num}`);
      });

      // フルニュースブロック
      const fullCard = document.createElement("div");
      fullCard.className = "card";
      fullCard.innerHTML = `
        <h2>Full News Audio</h2>
        <audio id="audioFull" controls>
          <source src="./${baseFile}/${baseFile}.mp3" type="audio/mpeg">
        </audio>
        <div class="status" id="statusFull">⬜ Not played</div>
        <button class="collapsible">📜 Show Full Script</button>
        <div class="content">${sentences.join('\n')}</div>
      `;
      container.appendChild(fullCard);
      setupBlock("audioFull", "statusFull", "audioPlayed_full");

      // 折りたたみスクリプト
      document.querySelectorAll(".collapsible").forEach(btn => {
        btn.addEventListener("click", function() {
          this.classList.toggle("active");
          const content = this.nextElementSibling;
          content.style.display = content.style.display === "block" ? "none" : "block";
        });
      });
    });
  </script>

</body>
</html>
